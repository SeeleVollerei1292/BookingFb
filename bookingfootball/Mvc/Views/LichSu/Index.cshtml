@using Mvc.Models
@model PaginatedList<LichSuDatSanViewModel>

@{
    ViewData["Title"] = "Lịch sử đặt sân";
}

<h1>Lịch sử đặt sân</h1>

@if (Model.Items.Any())
{
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Mã hóa đơn</th>
                <th>Ngày lập</th>
                <th>Tổng tiền</th>
                <th>Trạng thái hóa đơn</th>
                <th>Trạng thái thanh toán</th>
                <th>Chi tiết</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var hoaDon in Model.Items)
            {
                <tr>
                    <td>@hoaDon.MaHoaDon</td>
                    <td>@hoaDon.NgayLap.ToString("dd/MM/yyyy HH:mm")</td>
                    <td>@hoaDon.TongTien.ToString("C", new System.Globalization.CultureInfo("vi-VN"))</td>
                    <td>@hoaDon.GetFriendlyTrangThaiHoaDon()</td>
                    <td>@hoaDon.GetFriendlyTrangThaiThanhToan()</td>
                    <td>
                        <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#chiTiet-@hoaDon.HoaDonId" aria-expanded="false" aria-controls="chiTiet-@hoaDon.HoaDonId">
                            Xem chi tiết
                        </button>
                        <div class="collapse" id="chiTiet-@hoaDon.HoaDonId">
                            <div class="card card-body">
                                <h5>Thông tin khách hàng</h5>
                                <p>Tên: @hoaDon.TenNguoiDat</p>
                                <p>Email: @(hoaDon.Email ?? "Không có")</p>
                                <p>Số điện thoại: @(hoaDon.SoDienThoaiNguoiDat?.ToString() ?? "Không có")</p>
                                <h5>Chi tiết đặt sân</h5>
                                @foreach (var chiTiet in hoaDon.ChiTietDatSans)
                                {
                                    <div class="mb-3">
                                        <p><strong>Mã chi tiết: </strong>@chiTiet.MaChiTietHoaDon</p>
                                        <p><strong>Sân bóng: </strong>@chiTiet.TenSanBong</p>
                                        <p><strong>Ca: </strong>@chiTiet.TenCa (@chiTiet.StartTime.ToString("HH:mm") - @chiTiet.EndTime.ToString("HH:mm"))</p>
                                        <p><strong>Ngày đến sân: </strong>@chiTiet.NgayDenSan.ToString("dd/MM/yyyy")</p>
                                        <p><strong>Tiền thuê sân: </strong>@chiTiet.TienThueSan.ToString("C", new System.Globalization.CultureInfo("vi-VN"))</p>
                                        <p><strong>Giảm giá: </strong>@(chiTiet.TongTienDuocGiam?.ToString("C", new System.Globalization.CultureInfo("vi-VN")) ?? "0")</p>
                                        <p><strong>Tổng tiền: </strong>@chiTiet.TongTienChiTiet.ToString("C", new System.Globalization.CultureInfo("vi-VN"))</p>
                                        <p><strong>Ghi chú: </strong>@(chiTiet.GhiChu ?? "Không có")</p>
                                        @if (chiTiet.DichVus.Any())
                                        {
                                            <h6>Dịch vụ đi kèm</h6>
                                            <ul>
                                                @foreach (var dichVu in chiTiet.DichVus)
                                                {
                                                    <li>@dichVu.TenDichVu: @dichVu.SoLuong x @dichVu.DonGia.ToString("C", new System.Globalization.CultureInfo("vi-VN")) = @dichVu.TongTien.ToString("C", new System.Globalization.CultureInfo("vi-VN"))</li>
                                                }
                                            </ul>
                                        }
                                    </div>
                                }
                            </div>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <!-- Phân trang -->
    <nav aria-label="Page navigation">
        <ul class="pagination">
            @if (Model.HasPreviousPage)
            {
                <li class="page-item">
                    <a class="page-link" href="@Url.Action("Index", new { page = Model.PageIndex - 1, pageSize = Model.PageSize })">Previous</a>
                </li>
            }
            @for (var i = 1; i <= Model.TotalPages; i++)
            {
                <li class="page-item @(i == Model.PageIndex ? "active" : "")">
                    <a class="page-link" href="@Url.Action("Index", new { page = i, pageSize = Model.PageSize })">@i</a>
                </li>
            }
            @if (Model.HasNextPage)
            {
                <li class="page-item">
                    <a class="page-link" href="@Url.Action("Index", new { page = Model.PageIndex + 1, pageSize = Model.PageSize })">Next</a>
                </li>
            }
        </ul>
    </nav>
}
else
{
    <p>Chưa có lịch sử đặt sân.</p>
}

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
}